Language: [EN](https://github.com/EvansTrein/RESTful_exchangerServer/blob/main/README.md) [RU](https://github.com/EvansTrein/RESTful_exchangerServer/blob/main/readmeRU.md)

<div align="center">
  <h1>API обменника валют</h1>
</div>

<div>
  <h2>Как запустить?</h2>
</div>

Это запускается в docker, так для работы нужны: Postgres, Redis и сторонний gRPC сервис (образ будет скачан с моего dockerHub, он весит 50 MB)

Клонируйте или скачайте репозиторий - введите `make run-docker-compose`

Если make вы не пользуетесь - введите `docker compose --env-file config.env up --build -d`

перейдите по `http://localhost:8000/swagger/index.html`

<div>
  <h2>Как работает?</h2>
</div>

При регистарции, пользователю автоматически создаются счета в валютах (USD, EUR, CNY, RUB). С каждым счетом можно взаимодействовать - пополнить, списать, обменять одну валюту на другую. Для этих операций, необходимо выполнить вход (выдается JWT токен). Курс для обмена приходит с gRPC сервиса и кешируется, чтоб при повторном запросе не ходить снова в gRPC сервис. 

<div>
  <h2>Что и как тут используется?</h2>
</div>

**Фреймворк** - <u>Gin</u>, изначально, это было тестовое задание от одной компании и Gin был как требование. Но потом, задание потеряло актуальность, но я почти его сделал, к этому моменту. Тут можно было обойтись и без него. Каждый обработчик имеет по одному, своему методу. Т.е. обработчик может делать что-то одно. 

**Логгер** - <u>slog</u>, но написана собственная обертка. 

**База данных** - <u>Postgres</u>, 3 таблицы. Пользователи, валюты и счета (связь один к одному, один пользователь может иметь один счет в каждой валюте). Таблицы создаются через миграции при старте сервера (речь про запуск в docker, так-то есть отдельная команда для запуска миграций вручную), с помошью `github.com/golang-migrate/migrate/v4`. Валюты добавляются отдельной миграцией. При работе с счетами, используются транзакции и блокировка записи (ACID), чтобы не нарушалась бизнес логика.

**gRPC сервер** - написанный мною же, `https://github.com/EvansTrein/gRPC_exchangerServer`. Из него мы получаем курсы валют для обмена. Ответ сервера кешируется, чтобы каждый раз не ходить к нему.

**Кеш** - <u>Redis</u>, всего 2 операции. Сохранить по ключу, получить по ключу.

**Сервис Auth** - регистрация, выдача JWT токена для доступа к защищенным ресурсам и возможность удалить пользователя. Сервис имеет отдельный, специльный для него, интерфейс базы данных, в нем только те методы, которые нужны ему. Для проверки доступа при запросах, написан Middleware. 

**Сервис Wallet** - отвечает за операции с счетами. Пополнить, снять, обменять, получить текущий баланс, получить курс обмена по всем валютам. Именно он, взаимодейсвует с gRPC сервером как клиент, для этого написан отдельный интерфейс. Сервис имеет отдельный, специльный для него, интерфейс базы данных, в нем только те методы, которые нужны ему. Также, имеет отдельный интерфейс для обращения к кешу.

Для пересылки данных между всем, выше описанным, используются структуры (папка models). Написаны тесты и swagger документация.